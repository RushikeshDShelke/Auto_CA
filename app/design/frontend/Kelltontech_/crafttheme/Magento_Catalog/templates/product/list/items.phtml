<?php
/**
 * Mageplaza
 *
 * NOTICE OF LICENSE
 *
 * This source file is subject to the Mageplaza.com license that is
 * available through the world-wide-web at this URL:
 * https://www.mageplaza.com/LICENSE.txt
 *
 * DISCLAIMER
 *
 * Do not edit or add to this file if you wish to upgrade this extension to newer
 * version in the future.
 *
 * @category    Mageplaza
 * @package     Mageplaza_Productslider
 * @copyright   Copyright (c) Mageplaza (https://www.mageplaza.com/)
 * @license     https://www.mageplaza.com/LICENSE.txt
 */

//use Magento\Framework\App\Action\Action;
//use Mageplaza\Productslider\Block\AbstractSlider;

/** @var AbstractSlider $block */



//$id = $block->getData('page_var_name') . uniqid('', false); die;
//$items = $block->getProductCollection();

?>

<?php
$class = '';
$title = '';
$items = array();
switch ($type = $block->getType()) {

    case 'related-rule':
        if ($exist = $block->hasItems()) {
            $type = 'related';
            $class = $type;

            $image = 'related_products_list';
            $title = __('Related Products');
            $items = $block->getAllItems();
            $limit = $block->getPositionLimit();
            $shuffle = (int) $block->isShuffled();
            $canItemsAddToCart = $block->canItemsAddToCart();

            $showAddTo = true;
            $showCart = true;
            $templateType = null;
            $description = false;
        }
        break;

    case 'related':
        /** @var \Magento\Catalog\Block\Product\ProductList\Related $block */
        if ($exist = $block->getItems()->getSize()) {
            $type = 'related';
            $class = $type;

            $image = 'related_products_list';
            $title = __('Related Products');
            $items = $block->getItems();
            $limit = 0;
            $shuffle = 0;
            $canItemsAddToCart = $block->canItemsAddToCart();

            $showAddTo = true;
            $showCart = true;
            $templateType = null;
            $description = false;
        }
        break;

    case 'upsell-rule':
        if ($exist = $block->hasItems()) {
            $type = 'upsell';
            $class = $type;

            $image = 'upsell_products_list';
            $title = __('We found other products you might like!');
            $items = $block->getAllItems();
            $limit = $block->getPositionLimit();
            $shuffle = (int) $block->isShuffled();

            $showAddTo = false;
            $showCart = false;
            $templateType = null;
            $description = false;
            $canItemsAddToCart = false;
        }
        break;

    case 'upsell':
        /** @var \Magento\Catalog\Block\Product\ProductList\Upsell $block */
        if ($exist = count($block->getItemCollection()->getItems())) {
            $type = 'upsell';
            $class = $type;

            $image = 'upsell_products_list';
            $title = __('We found other products you might like!');
            $items = $block->getItemCollection()->getItems();
            $limit = $block->getItemLimit('upsell');
            $shuffle = 0;

            $showAddTo = false;
            $showCart = false;
            $templateType = null;
            $description = false;
            $canItemsAddToCart = false;
        }
        break;

    case 'crosssell-rule':
        /** @var \Magento\Catalog\Block\Product\ProductList\Crosssell $block */
        if ($exist = $block->hasItems()) {
            $type = 'crosssell';
            $class = $type;

            $image = 'cart_cross_sell_products';
            $title = __('More Choices:');
            $items = $block->getItemCollection();

            $showAddTo = true;
            $showCart = true;
            $templateType = \Magento\Catalog\Block\Product\ReviewRendererInterface::SHORT_VIEW;
            $description = false;
            $canItemsAddToCart = false;
        }
        break;

    case 'crosssell':
        /** @var \Magento\Catalog\Block\Product\ProductList\Crosssell $block */
        if ($exist = count($block->getItems())) {
            $type = 'crosssell';
            $class = $type;

            $image = 'cart_cross_sell_products';
            $title = __('More Choices:');
            $items = $block->getItems();

            $showAddTo = true;
            $showCart = true;
            $templateType = \Magento\Catalog\Block\Product\ReviewRendererInterface::SHORT_VIEW;
            $description = false;
            $canItemsAddToCart = false;
        }
        break;

    case 'new':
        if ($exist = $block->getProductCollection()) {
            $type = 'new';
            $mode = 'grid';
            $type = $type . ' ' . $mode;

            $class = 'widget' . ' ' . $type;

            $image = 'new_products_content_widget_grid';
            $title = __('New Products');
            $items = $exist;

            $showAddTo = true;
            $showCart = true;
            $templateType = \Magento\Catalog\Block\Product\ReviewRendererInterface::SHORT_VIEW;
            $description = ($mode == 'list') ? true : false;
            $canItemsAddToCart = false;
        }
        break;

    default:
        $exist = null;
}

?>

<?php if ($type == 'related') :?>
<div class="block related" data-limit="0" data-shuffle="0">
<div class="block-title title">
                <strong id="block-<?= $block->escapeHtmlAttr(isset($class)) ?>-heading" role="heading" aria-level="2"><?= $block->escapeHtml($title) ?></strong>
</div>
    <div class="mp-product-slider-block widget block-products-list">
        <h2 class="mp-product-slider-title"><?= $block->escapeHtml($block->getTitle()) ?></h2>
		
        <p class="mp-ps-info"><?= $block->escapeHtml($block->getDescription()) ?></p>
    </div>
	
    <div class="block-content mp-product-slider-content">
        <div class="products-grid grid">
            <ol class="product-items widget-viewed-grid">
                <?php $iterator = 1; ?>
                <div id="mp-list-items"
                     class="owl-carousel owl-theme">
                    <?php foreach ($items as $_item): ?>
                        <?= ($iterator++ == 1) ? '<li class="product-item product-slider"">' : '</li><li class="product-item product-slider"">' ?>
                        <div class="slider-product-item-info">
                            <a href="<?= $block->escapeUrl($block->getProductUrl($_item)) ?>"
                               class="product photo slider-product-item-photo">
                                <?=  $block->getImage($_item, 'recently_viewed_products_grid_content_widget')->toHtml(); ?>
                            </a>
							
                            <div class="product details slider-product-item-details">
                                <strong class="product name product-item-name">
                                    <a title="<?= $block->escapeHtml($_item->getName()) ?>"
                                       href="<?= $block->escapeUrl($block->getProductUrl($_item)) ?>">
                                        <?= $block->escapeHtml($_item->getName()) ?>
                                    </a>
                                </strong>
                            
                                 <?= /* @noEscape */ $block->getProductPrice($_item) ?>

                                    <?php if ($templateType) :?>
                                        <?= $block->getReviewsSummaryHtml($_item, $templateType) ?>
                                    <?php endif; ?>

                                    <?php if ($canItemsAddToCart && !$_item->isComposite() && $_item->isSaleable() && $type == 'related') :?>
                                        <?php if (!$_item->getRequiredOptions()) :?>
                                            <div class="field choice related">
                                                <input type="checkbox" class="checkbox related" id="related-checkbox<?= $block->escapeHtmlAttr($_item->getId()) ?>" name="related_products[]" value="<?= $block->escapeHtmlAttr($_item->getId()) ?>" />
                                                <label class="label" for="related-checkbox<?= $block->escapeHtmlAttr($_item->getId()) ?>"><span style="font-size: 11px!important;line-height: 1px!important;"><?= $block->escapeHtml(__('Add to Cart')) ?></span></label>
                                            </div>
                                        <?php endif; ?>
                                    <?php endif; ?>  
							
                                   
		
                                    <div class="product actions slider-product-item-actions product-item-actions">
                                        <?php //if ($block->canShowAddToCart()): ?>
                                            <div class="actions-primary">
                                                <?php //if ($_item->isSaleable()): ?>
                                                    <?php //$postParams = $block->getAddToCartPostParams($_item); ?>
												<?php //if ($showAddTo || $showCart) :?>
                                        <div class="product actions product-item-actions">
                                            <?php //if ($showCart) :?>
                                                <div class="actions-primary">
                                                    <?php if ($_item->isSaleable()) :?>
                                                        <?php if ($_item->getTypeInstance()->hasRequiredOptions($_item)) :?>
                                                            <button class="action tocart primary" data-mage-init='{"redirectUrl": {"url": "<?= $block->escapeUrl($block->getAddToCartUrl($_item)) ?>"}}' type="button" title="<?= $block->escapeHtmlAttr(__('Add to Cart')) ?>">
                                                                <span style="font-size: 11px!important;line-height: 1px!important;"><?= $block->escapeHtml(__('Add to Cart')) ?></span>
                                                            </button>
                                                        <?php else :?>
                                                            <?php $postDataHelper = $this->helper(Magento\Framework\Data\Helper\PostHelper::class);
                                                            $postData = $postDataHelper->getPostData($block->escapeUrl($block->getAddToCartUrl($_item)), ['product' => $_item->getEntityId()])
                                                            ?>
															<a class="weltpixel-quickview weltpixel_quickview_button_v2">
                                                            <button class="action tocart primary"
                                                                    data-post='<?= /* @noEscape */ $postData ?>'
                                                                    type="button" title="<?= $block->escapeHtmlAttr(__('Add to Cart')) ?>">
                                                                <span style="font-size: 11px!important;line-height: 1px!important;" ><?= $block->escapeHtml(__('Add to Cart')) ?></span>
                                                            </button>
															
															</a>
                                                        <?php endif; ?>
                                                    <?php else :?>
                                                        <?php if ($_item->getIsSalable()) :?>
                                                            <div class="stock available"><span><?= $block->escapeHtml(__('In stock')) ?></span></div>
                                                        <?php else :?>
                                                           <div class="ouf-of-stock-list">
														   <div class="stock unavailable"><span><?= $block->escapeHtml(__('Sold Out')) ?></span></div>
														   </div>
                                                        <?php endif; ?>
                                                    <?php endif; ?>
                                                </div>
                                            <?php ///endif; ?>

                                            <?php if ($showAddTo) :?>
                                                <div class="secondary-addto-links actions-secondary" data-role="add-to-links">
                                                    <?php if ($addToBlock = $block->getChildBlock('addto')) :?>
                                                        <?= $addToBlock->setProduct($_item)->getChildHtml() ?>
                                                    <?php endif; ?>
                                                </div>
                                            <?php endif; ?>
                                        </div>
                                    <?php //endif; ?>
                                                <?php //endif; ?>
                                            </div>
                                           
                                        <?php //endif; ?>
                                    </div>
                                </div>
                            </div>
                            <?= ($iterator === count($items) + 1) ? '</li>' : '' ?>
                    <?php endforeach ?>
                    </div>
                </ol>
            </div>
            <?= $block->getPagerHtml() ?>
        </div>
			</div>
		<?php endif;?>
	
    <script>
        require(['jquery', 'mageplaza/core/owl.carousel'], function ($) {
            $('#mp-list-items').owlCarousel({
				loop:true,
    margin:10,
    responsiveClass:true,
    responsive:{
        0:{
            items:1,
            nav:true
        },
        600:{
            items:3,
            nav:false
        }
    }
			});
        });
    </script>
<style>
.owl-stage-outer {
    margin-left: 37px!important;
}

@media(max-width:768px){
.owl-stage-outer {
    margin-left: 31px!important;
}
/*.unavailable{
margin-top: 343px!important;	
}*/
.custombutton{
	top: 355px!important;
}
}

.product.actions.slider-product-item-actions.product-item-actions {
   /* z-index: 9999; */
	
}
.products-grid .actions {
    padding-top: 10px;
    position: absolute;
    bottom: unset;
    min-height: unset;
    width: 100%;
    top: unset;
    left: 0;
    margin: 0;
}
.slider-product-item-actions .product-item-actions {
    padding-top: 10px!important;
    position: absolute!important;
    bottom: 46px!important;
    min-height: unset!important;
    width: 100%!important;
    top: unset!important;
    background: rgba(0, 0, 0, 0.5)!important;;
    z-index: 99;
    left: 0;
    padding: 10px;
    margin: 0!important;
}
.slider-product-item-info {
    position: relative;
}
.ouf-of-stock-list {
	top: -420px!important;
}
</style>
